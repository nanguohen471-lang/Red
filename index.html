<!doctype html>
<html lang="zh-TW" class="h-full">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>ç›´è¦ºå¡”ç¾…</title>
  <script src="/_sdk/element_sdk.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
    }
    
    html, body {
      height: 100%;
      width: 100%;
      background-color: #0a0a1f;
      box-sizing: border-box;
      overflow: hidden;
    }
    
    #app {
      background-color: #0a0a1f;
      height: 100%;
      width: 100%;
      overflow-y: auto;
      overflow-x: hidden;
      position: relative;
      scrollbar-width: none;
      -ms-overflow-style: none;
    }
    
    #app::-webkit-scrollbar {
      display: none;
    }
    
    .button-disabled {
      opacity: 0.5 !important;
      pointer-events: none !important;
      cursor: not-allowed !important;
    }
    
    @media (min-width: 1366px) {
      .main-container {
        transform: scale(1.05);
        transform-origin: center center;
      }
      .home-logo {
        max-width: 320px !important;
      }
      .home-title {
        font-size: 1.8rem !important;
      }
      .home-subtitle {
        font-size: 1.2rem !important;
      }
      .main-button {
        font-size: 1.3rem !important;
        padding: 1.3rem !important;
      }
      .secondary-button {
        font-size: 1rem !important;
        padding: 0.9rem !important;
      }
      .result-card-display {
        max-width: 420px !important;
      }
      .animation-title {
        font-size: 2rem !important;
      }
    }
    
    @media (min-width: 1920px) and (min-height: 1080px) {
      .main-container {
        transform: scale(1.15);
      }
      .home-content-box {
        max-width: 750px !important;
      }
    }
    
    @media (min-width: 768px) and (max-width: 1365px) {
      .main-container {
        transform: scale(1.0);
      }
    }
    
    @media (max-width: 767px) and (orientation: portrait) {
      .home-content-box {
        padding: 1.2rem 1rem !important;
      }
      .button-grid {
        gap: 0.8rem !important;
      }
    }
    
    @media (max-width: 896px) and (orientation: landscape) {
      .home-content-box {
        max-width: 600px !important;
        padding: 1rem !important;
      }
    }
    
    @keyframes fairySpread {
      0% {
        opacity: 0;
        transform: translate(-50%, -50%) scale(0.3) rotate(0deg);
      }
      30% {
        opacity: 1;
        transform: translate(-50%, -50%) scale(0.6) rotate(720deg);
      }
      100% {
        opacity: 1;
      }
    }
    
    @keyframes float {
      0%, 100% { transform: translateY(0px); }
      50% { transform: translateY(-5px); }
    }
    
    @keyframes glow {
      0%, 100% { 
        box-shadow: 0 0 20px rgba(255, 215, 0, 0.3),
                    0 0 40px rgba(255, 215, 0, 0.15);
      }
      50% { 
        box-shadow: 0 0 35px rgba(255, 215, 0, 0.5),
                    0 0 70px rgba(255, 215, 0, 0.25);
      }
    }
    
    @keyframes shimmer {
      0% { background-position: 0% center; }
      100% { background-position: 200% center; }
    }
    
    @keyframes slideIn {
      from { 
        opacity: 0;
        transform: translateY(30px);
      }
      to { 
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    @keyframes breathe {
      0%, 100% { 
        transform: scale(1);
        opacity: 0.9;
      }
      50% { 
        transform: scale(1.02);
        opacity: 1;
      }
    }
    
    @keyframes cardPulse {
      0%, 100% {
        box-shadow: 0 0 60px rgba(255, 215, 0, 0.9),
                    0 0 100px rgba(255, 215, 0, 0.6);
      }
      50% {
        box-shadow: 0 0 80px rgba(255, 215, 0, 1),
                    0 0 130px rgba(255, 215, 0, 0.8);
      }
    }
    
    @keyframes runeGlow {
      0%, 100% { opacity: 0.7; text-shadow: 0 0 15px rgba(255, 215, 0, 0.6); }
      50% { opacity: 1; text-shadow: 0 0 30px rgba(255, 215, 0, 1); }
    }
    
    @keyframes starfield {
      0% { transform: translateY(0); }
      100% { transform: translateY(-100px); }
    }
    
    .float-animation {
      animation: float 3s ease-in-out infinite;
    }
    
    .glow-animation {
      animation: glow 3s ease-in-out infinite;
    }
    
    .slide-in {
      animation: slideIn 0.7s ease-out;
    }
    
    .breathe-animation {
      animation: breathe 5s ease-in-out infinite;
    }
    
    .rune-symbol {
      animation: runeGlow 2.5s ease-in-out infinite;
    }
    
    .golden-frame {
      border: 3px solid #ffd700;
      box-shadow: 0 0 30px rgba(255, 215, 0, 0.5);
    }
    
    .starfield {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 200%;
      pointer-events: none;
      z-index: 0;
      animation: starfield 120s linear infinite;
    }
    
    .star {
      position: absolute;
      background: white;
      border-radius: 50%;
      animation: float 4s ease-in-out infinite;
    }
    
    .tarot-card {
      transition: transform 0.2s ease, box-shadow 0.2s ease;
      cursor: pointer;
      touch-action: none;
      user-select: none;
    }
    
    @media (min-width: 1024px) {
      .tarot-card:hover {
        transform: translate(-50%, -50%) scale(1.8) !important;
        z-index: 1500 !important;
        box-shadow: 0 0 70px rgba(255, 215, 0, 1) !important;
        border-color: #ffd700 !important;
        animation: cardPulse 0.5s ease-in-out infinite !important;
      }
    }
    
    @media (hover: none) {
      .tarot-card:active {
        transform: translate(-50%, -50%) scale(1.5) !important;
        z-index: 1500 !important;
      }
    }
  </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
 </head>
 <body class="h-full">
  <div id="app" class="w-full h-full"></div>
  <script>
    // ============================================
    // å…¨åŸŸç‹€æ…‹ç®¡ç†ç³»çµ± - å–®ä¸€çœŸå¯¦ä¾†æº
    // ============================================
    const AppState = {
      currentPage: "home",
      selectedCard: null,
      shuffledCards: [],
      isLocked: false,
      lastActionTime: 0,
      activeTimers: new Set(),
      
      // é–å®šç³»çµ±
      lock() {
        this.isLocked = true;
        this.lastActionTime = Date.now();
      },
      
      unlock() {
        this.isLocked = false;
      },
      
      canExecute() {
        const now = Date.now();
        const timeSinceLastAction = now - this.lastActionTime;
        return !this.isLocked && timeSinceLastAction > 500;
      },
      
      // æ¸…é™¤æ‰€æœ‰è¨ˆæ™‚å™¨
      clearAllTimers() {
        this.activeTimers.forEach(timer => clearTimeout(timer));
        this.activeTimers.clear();
      },
      
      // è¨»å†Šè¨ˆæ™‚å™¨
      registerTimer(timer) {
        this.activeTimers.add(timer);
      }
    };

    const defaultConfig = {
      background_color: "#0a0a1f",
      surface_color: "#1a1a3e",
      text_color: "#e0e7ff",
      primary_action_color: "#4338ca",
      secondary_action_color: "#6366f1",
      font_family: "sans-serif",
      font_size: 18,
      app_title: "å¨ç§€å½±åŸç›´è¦ºå¡”ç¾…ç‰Œ",
      app_subtitle: "é›»å½±é–‹æ¼”å‰ååˆ†é˜\nå…ˆä¾†æŠ½ä¸€å¼µç‰Œçœ‹çœ‹\nğŸ‘‰ é—œå¿ƒè‡ªå·±çš„å¿ƒæƒ…ç‹€æ…‹\nä¸å•æ˜Ÿåº§ï¼Œä¸çœ‹è¡€å‹ğŸ‘€\næ›´ç”¨ä¸åˆ°æ°´æ™¶çƒ ğŸ”®\nåªæœ‰ä½ çš„ç›´è¦ºæœ€æº–äº†ï¼",
      start_button_text: "å•Ÿå‹•ç¥ç§˜å¡”ç¾…",
      restart_button_text: "é‡æ–°æŠ½ç‰Œ",
      guide_button_text: "èªè­˜22å¼µå¨ç§€å¡”ç¾…ç‰Œ"
    };

    const tarotCards = [
      { name: "æ„šè€…", number: "0", image: "https://static.wixstatic.com/media/bd0ac1_62eb3bc839b34c429f34c6fb283651a1~mv2.png", upright: "èªªèµ°å°±èµ°å‹ï½œé©åˆä¸åšåŠŸèª²ç›´æ¥è²·ç¥¨", reversed: "æƒ³å¤ªå¤šå‹ï½œGoogleäº†ä¸€å°æ™‚é‚„æ²’è²·ç¥¨" },
      { name: "é­”è¡“å¸«", number: "I", image: "https://static.wixstatic.com/media/bd0ac1_044cc5a9b9a54f458eee0532cbfad7e2~mv2.png", upright: "å…¨å‰¯æ­¦è£å‹ï½œæ‰‹æ©Ÿã€å……é›»å¯¶ã€å¤–å¥—éƒ½å¸¶äº†", reversed: "ä¸Ÿä¸‰è½å››å‹ï½œåˆ°å½±å»³æ‰ç™¼ç¾ç¥¨ç•™åœ¨å®¶è£¡" },
      { name: "å¥³ç¥­å¸", number: "II", image: "https://static.wixstatic.com/media/bd0ac1_8a7fa38c73e44d6f8c2203c1158db613~mv2.png", upright: "å°ˆå¿ƒè§€å½±å‹ï½œæœ€è¨å­æœ‰äººåœ¨é›»å½±é™¢è¬›è©±", reversed: "å¿ƒä¸åœ¨ç„‰å‹ï½œä¸€ç›´æ»‘æ‰‹æ©Ÿæ ¹æœ¬æ²’åœ¨çœ‹é›»å½±" },
      { name: "çš‡å", number: "III", image: "https://static.wixstatic.com/media/bd0ac1_a10de7bc880c46a8b766f67c1757f93d~mv2.png", upright: "äº«å—æ´¾ï½œçˆ†ç±³èŠ±ã€å¯æ¨‚ã€ç†±ç‹—å…¨éƒ½ä¾†ä¸€ä»½", reversed: "å§”å±ˆè‡ªå·±å‹ï½œæ˜æ˜æƒ³åƒæƒ³å–ï¼Œå»ä¸å¥½æ„æ€æ‹’çµ•åˆ¥äºº" },
      { name: "çš‡å¸", number: "IV", image: "https://static.wixstatic.com/media/bd0ac1_4eb5ed4a687e4fdb822bc79e0a65c06e~mv2.png", upright: "æº–æ™‚å…¥å ´å‹ï½œææ—©15åˆ†é˜åˆ°ï¼Œçµ•ä¸éŒ¯éç‰‡é ­", reversed: "ç¸½æ˜¯é²åˆ°å‹ï½œéƒ½è¦é–‹æ¼”å‰10åˆ†é˜æ‰ç·©ç·©èµ°é€²å½±å»³" },
      { name: "æ•™çš‡", number: "V", image: "https://static.wixstatic.com/media/bd0ac1_58b25db21b1643fab5d51056b095030b~mv2.png", upright: "å½±è©•å°ˆå®¶å‹ï½œçœ‹å®Œä¸€å®šè¦è¨è«–åŠ‡æƒ…å’Œå½©è›‹", reversed: "ä¸æ„›èŠå¤©å‹ï½œçœ‹å®Œåªæƒ³å®‰éœå›å®¶" },
      { name: "æˆ€äºº", number: "VI", image: "https://static.wixstatic.com/media/bd0ac1_c86393ed4572418a87cb53e24aecb7c9~mv2.png", upright: "æƒ…ä¾¶çœ‹ç‰‡å‹ï½œé¸ç‰‡ç¸½æ˜¯è¦å–¬åˆ°å…©å€‹äººéƒ½å–œæ­¡æ‰æœƒè²·", reversed: "é¸ç‰‡é›£å‹ï½œä»–æƒ³çœ‹é€™éƒ¨ä½ æƒ³çœ‹é‚£éƒ¨" },
      { name: "æˆ°è»Š", number: "VII", image: "https://static.wixstatic.com/media/bd0ac1_782e31d4abeb411fb9b5279be2a0880a~mv2.png", upright: "ç›®æ¨™æ˜ç¢ºå‹ï½œä¸€å®šè¦æ¶IMAXæœ€ä½³åº§ä½", reversed: "è¿·å¤±æ–¹å‘å‹ï½œè¶…ç´šç³Šå¡—èŸ²ï¼Œæ‹¿åˆ°é›»å½±ç¥¨å°±æ‰¾ä¸åˆ°å½±å»³" },
      { name: "åŠ›é‡", number: "VIII", image: "https://static.wixstatic.com/media/bd0ac1_8a465673b747416e955b4cfe7005063d~mv2.png", upright: "æ·¡å®šçœ‹ç‰‡å‹ï½œå†ææ€–çš„éƒ½ä¸æœƒå°–å«", reversed: "å®¹æ˜“é©šåš‡å‹ï½œçœ‹åˆ°åˆºæ¿€ç•«é¢å°±é–‰çœ¼ç›" },
      { name: "éš±è€…", number: "IX", image: "https://static.wixstatic.com/media/bd0ac1_68d3cc179ded4192bff2b6be5e6dc590~mv2.png", upright: "ä¸€å€‹äººçœ‹ç‰‡å‹ï½œäº«å—ç¨è™•çš„æ™‚å…‰", reversed: "å­¤å–®å¯‚å¯å‹ï½œå…¶å¯¦å¾ˆæƒ³æœ‰äººé™ª" },
      { name: "å‘½é‹ä¹‹è¼ª", number: "X", image: "https://static.wixstatic.com/media/bd0ac1_9ff92a460a3a47a3b413272a972a2159~mv2.png", upright: "éš¨æ©Ÿé¸ç‰‡å‹ï½œè®“å‘½é‹æ±ºå®šçœ‹ä»€éº¼", reversed: "å€’æ¥£é¬¼å‹ï½œé¸åˆ°çˆ›ç‰‡è¸©åˆ°å¤§åœ°é›·" },
      { name: "æ­£ç¾©", number: "XI", image: "https://static.wixstatic.com/media/bd0ac1_c08fb4bc13374022a62ca814dcec0b16~mv2.png", upright: "å®¢è§€è©•åƒ¹å‹ï½œå¥½ç‰‡çµ¦å¥½è©•ï¼Œçˆ›ç‰‡çµ¦è² è©•", reversed: "ä¸å…¬å¾…é‡å‹ï½œæ˜æ˜æ˜¯å¥½ç‰‡å»è¢«ç½µçˆ†" },
      { name: "å€’åŠäºº", number: "XII", image: "https://static.wixstatic.com/media/bd0ac1_0aecd855ffad4e50a9610a30da9f5120~mv2.png", upright: "æ›å€‹è§’åº¦å‹ï½œå˜—è©¦çœ‹ä¸€ç¨®ä¸åŒé¡å‹çš„ç‰‡", reversed: "å¡ä½èµ°ä¸äº†å‹ï½œæƒ³çœ‹ä½†ä¸€ç›´æ‰¾è—‰å£èªªæ™‚é–“å–¬ä¸æ”" },
      { name: "æ­»ç¥", number: "XIII", image: "https://static.wixstatic.com/media/bd0ac1_b7e01dc8cec54ce8821b139491c92ac2~mv2.png", upright: "é‡æ–°é–‹å§‹å‹ï½œæŠŠèˆŠçš„ç‰‡å–®æ¸…ç©ºï¼Œé–‹å§‹çœ‹æ–°çš„", reversed: "ä¸æƒ³çµæŸå‹ï½œé›»å½±çµæŸäº†é‚„æ¨ä¸å¾—é›¢é–‹" },
      { name: "ç¯€åˆ¶", number: "XIV", image: "https://static.wixstatic.com/media/bd0ac1_de75abaf6a934e6fbe13a7e5bb392bdb~mv2.png", upright: "å¹³è¡¡è§€å½±å‹ï½œä¸æœƒä¸€å£æ°£è¿½å®Œæ•´å€‹ç³»åˆ—", reversed: "éåº¦æ²‰è¿·å‹ï½œæ›¾æœ‰é€£åˆ·ä¸‰å ´é›»å½±ä¸å›å®¶" },
      { name: "æƒ¡é­”", number: "XV", image: "https://static.wixstatic.com/media/bd0ac1_30ebc6d16c65430fa58b71514b340e57~mv2.png", upright: "æ‰‹æ©Ÿæˆç™®å‹ï½œçœ‹é›»å½±ä¸€ç›´å¿ä¸ä½æ»‘æ‰‹æ©Ÿ", reversed: "æ“ºè„«æˆç™®å‹ï½œçµ‚æ–¼å¯ä»¥å°ˆå¿ƒçœ‹é›»å½±" },
      { name: "é«˜å¡”", number: "XVI", image: "https://static.wixstatic.com/media/bd0ac1_ee44ab0d43d04f7e8487f5a01f8afeec~mv2.png", upright: "å¤§çˆ†é›·å‹ï½œè¢«åŠ‡é€è¶…å´©æ½°", reversed: "é€ƒé¿å´©æ½°å‹ï½œä¸æƒ³é¢å°é›»å½±çš„çµå±€çœŸç›¸" },
      { name: "æ˜Ÿæ˜Ÿ", number: "XVII", image: "https://static.wixstatic.com/media/bd0ac1_3b2935c56d474748b7e1e302a66bda9a~mv2.png", upright: "å¿ƒæƒ…ç™‚ç™’å‹ï½œçœ‹å®Œé›»å½±å°äººç”Ÿå……æ»¿å¸Œæœ›", reversed: "å¤±æœ›é€é ‚å‹ï½œæœŸå¾…å¾ˆé«˜çµæœå»å¤±æœ›" },
      { name: "æœˆäº®", number: "XVIII", image: "https://static.wixstatic.com/media/bd0ac1_a35da5a86cda4bd2a9844fbf2a9ef3cc~mv2.png", upright: "æ·±å¤œè²“é ­é·¹å‹ï½œæ·±å¤œçœ‹é›»å½±ç‰¹åˆ¥æœ‰æ„Ÿè¦º", reversed: "çœ‹ä¸æ¸…æ¥šå‹ï½œçœ‹å®Œé›»å½±å®Œå…¨ä¸çŸ¥åœ¨æ¼”ä»€éº¼" },
      { name: "å¤ªé™½", number: "XIX", image: "https://static.wixstatic.com/media/bd0ac1_6c929514663445fcbac1773bc39ecf77~mv2.png", upright: "é–‹å¿ƒçœ‹ç‰‡å‹ï½œå°±æ˜¯çˆ½å°±æ˜¯é–‹å¿ƒ", reversed: "ç„¡æ„Ÿå‹ï½œæ˜æ˜æ˜¯å¥½ç‰‡ä½†çœ‹å®Œå»æ²’æ„Ÿè¦º" },
      { name: "å¯©åˆ¤", number: "XX", image: "https://static.wixstatic.com/media/bd0ac1_5a2a4024c2f3471e8efa0013e46747d4~mv2.png", upright: "é‡æ–°è©•åƒ¹å‹ï½œçœ‹ç¬¬äºŒæ¬¡ç™¼ç¾ä»¥å‰èª¤æœƒé€™éƒ¨ç‰‡äº†", reversed: "è‡ªæˆ‘å¯©åˆ¤å‹ï½œè¦ºå¾—è‡ªå·±å“å‘³å¾ˆå·®" },
      { name: "ä¸–ç•Œ", number: "XXI", image: "https://static.wixstatic.com/media/bd0ac1_ce93c4a3ab1b495b83c01ed8b9164292~mv2.png", upright: "å®Œç¾æ”¶å®˜å‹ï½œç³»åˆ—é›»å½±æœ€çµ‚ç« å®Œç¾çµå±€", reversed: "å·®ä¸€é»é»å‹ï½œå°±å·®ä¸€å¼µç¥¨å°±é›†æ»¿å„ªæƒ " }
    ];

    // ============================================
    // å‹•ä½œè™•ç†å™¨ - æ‰€æœ‰ä½¿ç”¨è€…äº’å‹•çš„å”¯ä¸€å…¥å£
    // ============================================
    const ActionHandler = {
      goToHome() {
        if (!AppState.canExecute()) return;
        AppState.lock();
        AppState.clearAllTimers();
        
        AppState.currentPage = "home";
        AppState.selectedCard = null;
        render();
        
        const timer = setTimeout(() => AppState.unlock(), 800);
        AppState.registerTimer(timer);
      },
      
      goToGuide() {
        if (!AppState.canExecute()) return;
        AppState.lock();
        AppState.clearAllTimers();
        
        AppState.currentPage = "guide";
        render();
        
        const timer = setTimeout(() => AppState.unlock(), 800);
        AppState.registerTimer(timer);
      },
      
      goToRules() {
        if (!AppState.canExecute()) return;
        AppState.lock();
        AppState.clearAllTimers();
        
        AppState.currentPage = "rules";
        render();
        
        const timer = setTimeout(() => AppState.unlock(), 800);
        AppState.registerTimer(timer);
      },
      
      drawCard() {
        if (!AppState.canExecute()) return;
        AppState.lock();
        AppState.clearAllTimers();
        
        AppState.shuffledCards = [...tarotCards].sort(() => Math.random() - 0.5);
        AppState.currentPage = "shuffling";
        render();
        
        const timer1 = setTimeout(() => {
          if (AppState.currentPage !== "shuffling") return;
          AppState.currentPage = "cutting";
          render();
        }, 2500);
        AppState.registerTimer(timer1);
        
        const timer2 = setTimeout(() => {
          if (AppState.currentPage !== "cutting") return;
          AppState.currentPage = "spreading";
          render();
        }, 5000);
        AppState.registerTimer(timer2);
        
        const timer3 = setTimeout(() => {
          if (AppState.currentPage !== "spreading") return;
          
          // ç”Ÿæˆé¸ä¸­çš„ç‰Œ
          const randomIndex = Math.floor(Math.random() * 22);
          const isReversed = Math.random() < 0.5;
          AppState.selectedCard = { ...AppState.shuffledCards[randomIndex], isReversed };
          
          // ç«‹å³è§£é–ï¼Œé¿å…é˜»å¡
          AppState.unlock();
          
          // åˆ‡æ›åˆ°çµæœé é¢
          AppState.currentPage = "result";
          render();
        }, 8500);
        AppState.registerTimer(timer3);
      }
    };

    // ============================================
    // äº‹ä»¶ç›£è½å™¨ç®¡ç† - ç¢ºä¿åªç¶å®šä¸€æ¬¡
    // ============================================
    const EventManager = {
      boundListeners: new Map(),
      
      attach(elementId, eventType, handler) {
        const element = document.getElementById(elementId);
        if (!element) return;
        
        const key = `${elementId}-${eventType}`;
        
        // ç§»é™¤èˆŠçš„ç›£è½å™¨
        if (this.boundListeners.has(key)) {
          const oldHandler = this.boundListeners.get(key);
          element.removeEventListener(eventType, oldHandler);
        }
        
        // ç¶å®šæ–°çš„ç›£è½å™¨
        const wrappedHandler = (e) => {
          e.preventDefault();
          e.stopPropagation();
          handler(e);
        };
        
        element.addEventListener(eventType, wrappedHandler, { passive: false, once: false });
        this.boundListeners.set(key, wrappedHandler);
      },
      
      detachAll() {
        this.boundListeners.clear();
      }
    };

    // ============================================
    // æ¸²æŸ“è¼”åŠ©å‡½æ•¸
    // ============================================
    function generateStarfield() {
      let html = '<div class="starfield">';
      for (let i = 0; i < 200; i++) {
        const x = Math.random() * 100;
        const y = Math.random() * 200;
        const size = Math.random() * 2.5 + 0.5;
        html += `<div class="star" style="left: ${x}%; top: ${y}%; width: ${size}px; height: ${size}px; opacity: ${Math.random() * 0.6 + 0.4};"></div>`;
      }
      html += '</div>';
      return html;
    }

    function renderResultPage(card, baseSize) {
      const app = document.getElementById("app");
      app.innerHTML = generateStarfield();
      
      const container = document.createElement('main');
      container.className = 'main-container';
      container.style.cssText = 'min-height: 100%; display: flex; align-items: center; justify-content: center; padding: ' + (baseSize * 0.7) + 'px; position: relative;';
      
      const wrapper = document.createElement('div');
      wrapper.className = 'slide-in';
      wrapper.style.cssText = 'max-width: 750px; width: 95%; margin: 0 auto; display: flex; flex-direction: column; align-items: center;';
      
      const cardDisplay = document.createElement('div');
      cardDisplay.className = 'golden-frame glow-animation result-card-display';
      cardDisplay.style.cssText = 'background: linear-gradient(135deg, rgba(26, 26, 62, 0.95), rgba(15, 23, 42, 0.95)); border-radius: ' + (baseSize * 1) + 'px; padding: ' + (baseSize * 1) + 'px; text-align: center; margin-bottom: ' + (baseSize * 0.7) + 'px; box-shadow: 0 25px 100px rgba(0, 0, 0, 0.7), 0 0 80px rgba(255, 215, 0, 0.25) inset; position: relative; width: 100%;';
      
      const titleDiv = document.createElement('div');
      titleDiv.style.cssText = 'margin-top: ' + (baseSize * 0.4) + 'px; font-size: ' + (baseSize * 0.95) + 'px; opacity: 0.9; margin-bottom: ' + (baseSize * 0.4) + 'px; letter-spacing: 1.5px; font-weight: 500;';
      titleDiv.textContent = 'ä½ æŠ½åˆ°çš„æ˜¯';
      cardDisplay.appendChild(titleDiv);
      
      const nameSection = document.createElement('div');
      nameSection.style.cssText = 'margin: ' + (baseSize * 0.7) + 'px 0;';
      const cardName = document.createElement('h2');
      cardName.style.cssText = 'font-size: ' + (baseSize * 1.7) + 'px; font-weight: bold; background: linear-gradient(135deg, #ffd700, #fbbf24, #ffd700); -webkit-background-clip: text; -webkit-text-fill-color: transparent; margin-bottom: ' + (baseSize * 0.4) + 'px; letter-spacing: 3px; filter: drop-shadow(0 0 25px rgba(255, 215, 0, 0.5));';
      cardName.textContent = card.name;
      const cardNumber = document.createElement('div');
      cardNumber.style.cssText = 'font-size: ' + (baseSize * 1.2) + 'px; opacity: 0.75; margin-bottom: ' + (baseSize * 0.4) + 'px; font-weight: 300; letter-spacing: 2.5px;';
      cardNumber.textContent = card.number;
      nameSection.appendChild(cardName);
      nameSection.appendChild(cardNumber);
      cardDisplay.appendChild(nameSection);
      
      const imageSection = document.createElement('div');
      imageSection.style.cssText = 'margin: ' + (baseSize * 0.8) + 'px 0; position: relative;';
      const glow = document.createElement('div');
      glow.style.cssText = 'position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: ' + (baseSize * 12) + 'px; height: ' + (baseSize * 12) + 'px; background: radial-gradient(circle, rgba(255, 215, 0, 0.2), transparent); border-radius: 50%; filter: blur(35px);';
      const img = document.createElement('img');
      img.src = card.image;
      img.alt = card.name;
      img.style.cssText = 'width: 100%; max-width: ' + (baseSize * 9) + 'px; height: auto; border-radius: ' + (baseSize * 0.6) + 'px; border: 3px solid #ffd700; ' + (card.isReversed ? 'transform: rotate(180deg);' : '') + ' box-shadow: 0 15px 60px rgba(0, 0, 0, 0.6), 0 0 40px rgba(255, 215, 0, 0.4); position: relative; z-index: 1; display: block; margin: 0 auto;';
      img.onerror = function() { this.style.display = 'none'; this.nextElementSibling.style.display = 'block'; };
      const fallback = document.createElement('div');
      fallback.style.cssText = 'display: none; font-size: ' + (baseSize * 4.5) + 'px; filter: drop-shadow(0 12px 35px rgba(255, 215, 0, 0.6));';
      fallback.textContent = 'ğŸ´';
      imageSection.appendChild(glow);
      imageSection.appendChild(img);
      imageSection.appendChild(fallback);
      cardDisplay.appendChild(imageSection);
      
      const meaningSection = document.createElement('div');
      const isReversed = card.isReversed;
      const bgGradient = isReversed ? 'rgba(220, 38, 38, 0.35), rgba(185, 28, 28, 0.25)' : 'rgba(34, 197, 94, 0.35), rgba(22, 163, 74, 0.25)';
      const borderColor = isReversed ? 'rgba(239, 68, 68, 0.6)' : 'rgba(74, 222, 128, 0.6)';
      const insetShadow = isReversed ? 'rgba(220, 38, 38, 0.15)' : 'rgba(34, 197, 94, 0.15)';
      const lineColor = isReversed ? 'rgba(239, 68, 68, 0.7)' : 'rgba(74, 222, 128, 0.7)';
      meaningSection.style.cssText = 'background: linear-gradient(135deg, ' + bgGradient + '); border: 2px solid ' + borderColor + '; border-radius: ' + (baseSize * 0.6) + 'px; padding: ' + (baseSize * 0.9) + 'px; margin-top: ' + (baseSize * 0.9) + 'px; box-shadow: 0 10px 40px rgba(0, 0, 0, 0.4), 0 0 25px ' + insetShadow + ' inset; position: relative; overflow: hidden;';
      
      const topLine = document.createElement('div');
      topLine.style.cssText = 'position: absolute; top: 0; left: 0; right: 0; height: 2px; background: linear-gradient(90deg, transparent, ' + lineColor + ', transparent);';
      meaningSection.appendChild(topLine);
      
      const badge = document.createElement('div');
      const badgeBg = isReversed ? 'rgba(220, 38, 38, 0.35)' : 'rgba(34, 197, 94, 0.35)';
      const badgeBorder = isReversed ? 'rgba(239, 68, 68, 0.6)' : 'rgba(74, 222, 128, 0.6)';
      badge.style.cssText = 'display: inline-block; background: ' + badgeBg + '; padding: ' + (baseSize * 0.35) + 'px ' + (baseSize * 0.9) + 'px; border-radius: ' + (baseSize * 2.5) + 'px; margin-bottom: ' + (baseSize * 0.5) + 'px; border: 1px solid ' + badgeBorder + ';';
      const badgeText = document.createElement('div');
      const textColor = isReversed ? '#fca5a5' : '#86efac';
      badgeText.style.cssText = 'font-size: ' + (baseSize * 0.9) + 'px; font-weight: bold; color: ' + textColor + '; letter-spacing: 1.5px;';
      badgeText.textContent = isReversed ? 'â¤µ é€†ä½ â¤µ' : 'â¤´ æ­£ä½ â¤´';
      badge.appendChild(badgeText);
      meaningSection.appendChild(badge);
      
      const meaningText = document.createElement('p');
      meaningText.style.cssText = 'font-size: ' + (baseSize * 0.95) + 'px; line-height: 1.7; position: relative; z-index: 1; font-weight: 500;';
      meaningText.textContent = isReversed ? card.reversed : card.upright;
      meaningSection.appendChild(meaningText);
      
      const bottomLine = document.createElement('div');
      bottomLine.style.cssText = 'position: absolute; bottom: 0; left: 0; right: 0; height: 2px; background: linear-gradient(90deg, transparent, ' + lineColor + ', transparent);';
      meaningSection.appendChild(bottomLine);
      
      cardDisplay.appendChild(meaningSection);
      wrapper.appendChild(cardDisplay);
      
      const buttonGrid = document.createElement('div');
      buttonGrid.style.cssText = 'display: grid; grid-template-columns: 1fr 1fr 1fr; gap: ' + (baseSize * 0.6) + 'px; width: 100%; max-width: 750px;';
      
      const restartBtn = document.createElement('button');
      restartBtn.id = 'restart-btn';
      restartBtn.className = 'golden-frame';
      restartBtn.style.cssText = 'background: linear-gradient(135deg, #6366f1, #4f46e5); padding: ' + (baseSize * 0.7) + 'px; border-radius: ' + (baseSize * 0.6) + 'px; font-size: ' + (baseSize * 0.75) + 'px; font-weight: bold; cursor: pointer; box-shadow: 0 6px 22px rgba(99, 102, 241, 0.5), 0 0 15px rgba(99, 102, 241, 0.25) inset; transition: all 0.3s ease; white-space: nowrap; touch-action: manipulation; user-select: none; border: none;';
      restartBtn.textContent = 'ğŸ”„ é‡æ–°æŠ½ç‰Œ';
      buttonGrid.appendChild(restartBtn);
      
      const homeBtn = document.createElement('button');
      homeBtn.id = 'home-btn-result';
      homeBtn.className = 'golden-frame';
      homeBtn.style.cssText = 'background: linear-gradient(135deg, #8b5cf6, #7c3aed); padding: ' + (baseSize * 0.7) + 'px; border-radius: ' + (baseSize * 0.6) + 'px; font-size: ' + (baseSize * 0.75) + 'px; font-weight: bold; cursor: pointer; box-shadow: 0 6px 22px rgba(139, 92, 246, 0.5), 0 0 15px rgba(139, 92, 246, 0.25) inset; transition: all 0.3s ease; white-space: nowrap; touch-action: manipulation; user-select: none; border: none;';
      homeBtn.textContent = 'ğŸ  è¿”å›é¦–é ';
      buttonGrid.appendChild(homeBtn);
      
      const lineLink = document.createElement('a');
      lineLink.href = 'https://page.line.me/714uxbzn?openExternalBrowser=1';
      lineLink.target = '_blank';
      lineLink.rel = 'noopener noreferrer';
      lineLink.className = 'golden-frame';
      lineLink.style.cssText = 'display: flex; align-items: center; justify-content: center; background: linear-gradient(135deg, #ffd700, #f59e0b, #ffd700); padding: ' + (baseSize * 0.7) + 'px; border-radius: ' + (baseSize * 0.6) + 'px; font-size: ' + (baseSize * 0.7) + 'px; font-weight: bold; cursor: pointer; color: #000000; box-shadow: 0 6px 22px rgba(255, 215, 0, 0.6), 0 0 15px rgba(255, 215, 0, 0.35) inset; transition: all 0.3s ease; white-space: nowrap; touch-action: manipulation; user-select: none; text-decoration: none;';
      lineLink.textContent = 'ğŸ’¬ åŠ å…¥å¨ç§€å½±åŸLINE@';
      buttonGrid.appendChild(lineLink);
      
      wrapper.appendChild(buttonGrid);
      container.appendChild(wrapper);
      app.appendChild(container);
      
      // ç¶å®šäº‹ä»¶
      EventManager.attach('restart-btn', 'click', ActionHandler.drawCard);
      EventManager.attach('home-btn-result', 'click', ActionHandler.goToHome);
    }

    // ============================================
    // ä¸»æ¸²æŸ“å‡½æ•¸
    // ============================================
    function render() {
      const config = window.elementSdk ? window.elementSdk.config : defaultConfig;
      const baseSize = config.font_size || defaultConfig.font_size;
      const app = document.getElementById("app");
      const starfield = generateStarfield();
      
      if (AppState.currentPage === "home") {
        app.innerHTML = starfield + `
          <main class="main-container" style="min-height: 100%; display: flex; align-items: center; justify-content: center; padding: ${baseSize * 0.8}px; position: relative;">
            <div class="golden-frame breathe-animation home-content-box" style="background: linear-gradient(135deg, rgba(26, 26, 62, 0.95), rgba(15, 23, 42, 0.95)); backdrop-filter: blur(30px); border-radius: ${baseSize * 1.2}px; padding: ${baseSize * 1.5}px ${baseSize * 1.2}px; max-width: 650px; width: 100%; max-height: 95%; position: relative; z-index: 1; box-shadow: 0 20px 100px rgba(0, 0, 0, 0.7), 0 0 80px rgba(255, 215, 0, 0.25) inset; display: flex; flex-direction: column; justify-content: center;">
              <div class="text-center" style="margin-bottom: ${baseSize * 1}px;">
                <div style="margin-bottom: ${baseSize * 0.3}px;">
                  <img src="https://static.wixstatic.com/media/bd0ac1_d2b79c1f87a444579a8077478d3703b4~mv2.png" alt="å¨ç§€å½±åŸ" class="home-logo" style="width: 70%; max-width: ${baseSize * 10}px; height: auto; display: block; margin: 0 auto; filter: drop-shadow(0 0 30px rgba(255, 215, 0, 0.7));" onerror="this.style.display='none';">
                </div>
                <h1 class="home-title" style="font-size: ${baseSize * 1.2}px; font-weight: bold; background: linear-gradient(135deg, #ffd700 0%, #fbbf24 25%, #e0e7ff 50%, #fbbf24 75%, #ffd700 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-size: 200% auto; animation: shimmer 4s ease-in-out infinite; margin-bottom: ${baseSize * 0.4}px; letter-spacing: 2px; line-height: 1.3;">
                  ${config.app_title}
                </h1>
                <div style="font-size: ${baseSize * 0.9}px; opacity: 0.95; margin-bottom: ${baseSize * 0.3}px;" class="rune-symbol">âŸ¡ â˜† âŸ¡</div>
                <div style="width: ${baseSize * 3}px; height: 2px; background: linear-gradient(90deg, transparent, #ffd700, transparent); margin: ${baseSize * 0.5}px auto;"></div>
              </div>
              
              <div class="home-subtitle" style="background: linear-gradient(135deg, rgba(99, 102, 241, 0.3), rgba(139, 92, 246, 0.25)); border: 2px solid rgba(255, 215, 0, 0.4); border-radius: ${baseSize * 0.8}px; padding: ${baseSize * 1}px; margin-bottom: ${baseSize * 1.2}px; box-shadow: 0 10px 40px rgba(0, 0, 0, 0.4), 0 0 25px rgba(99, 102, 241, 0.25) inset; position: relative; overflow: hidden;">
                <div style="position: absolute; top: 0; left: 0; right: 0; height: 2px; background: linear-gradient(90deg, transparent, rgba(255, 215, 0, 0.6), transparent);"></div>
                <p style="font-size: ${baseSize * 0.75}px; line-height: 1.5; text-align: center; position: relative; z-index: 1; white-space: pre-line; font-weight: 500;">${config.app_subtitle}</p>
                <div style="position: absolute; bottom: 0; left: 0; right: 0; height: 2px; background: linear-gradient(90deg, transparent, rgba(255, 215, 0, 0.6), transparent);"></div>
              </div>
              
              <button id="start-btn" class="golden-frame glow-animation main-button" style="background: linear-gradient(135deg, ${config.primary_action_color}, #6366f1, ${config.primary_action_color}); background-size: 200% auto; padding: ${baseSize * 0.9}px; width: 100%; border-radius: ${baseSize * 0.8}px; font-size: ${baseSize * 1}px; font-weight: bold; cursor: pointer; transition: all 0.3s ease; box-shadow: 0 12px 50px rgba(67, 56, 202, 0.5), 0 0 25px rgba(99, 102, 241, 0.4) inset; position: relative; overflow: hidden; margin-bottom: ${baseSize * 1}px; touch-action: manipulation; user-select: none; border: none;">
                <div style="position: absolute; top: 0; left: -100%; width: 100%; height: 100%; background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent); animation: shimmer 3s infinite;"></div>
                <span class="rune-symbol" style="position: relative; z-index: 1;">âœ¨ ${config.start_button_text} âœ¨</span>
              </button>
              
              <div class="button-grid" style="display: grid; grid-template-columns: 1fr 1fr; gap: ${baseSize * 0.8}px;">
                <button id="rules-btn" class="golden-frame secondary-button" style="background: linear-gradient(135deg, rgba(251, 191, 36, 0.3), rgba(217, 119, 6, 0.25)); padding: ${baseSize * 0.7}px; border-radius: ${baseSize * 0.6}px; font-size: ${baseSize * 0.7}px; font-weight: bold; cursor: pointer; transition: all 0.3s ease; box-shadow: 0 5px 20px rgba(0, 0, 0, 0.4); touch-action: manipulation; user-select: none; border: none;">æŠ½ç‰Œè¦å‰‡</button>
                <button id="guide-btn" class="golden-frame secondary-button" style="background: linear-gradient(135deg, rgba(251, 191, 36, 0.3), rgba(217, 119, 6, 0.25)); padding: ${baseSize * 0.7}px; border-radius: ${baseSize * 0.6}px; font-size: ${baseSize * 0.7}px; font-weight: bold; cursor: pointer; transition: all 0.3s ease; box-shadow: 0 5px 20px rgba(0, 0, 0, 0.4); touch-action: manipulation; user-select: none; border: none;">èªè­˜å¡”ç¾…ç‰Œ</button>
              </div>
              
              <div style="text-align: center; margin-top: ${baseSize * 0.8}px; font-size: ${baseSize * 0.6}px; opacity: 0.6; letter-spacing: 2px;">âœ§ ï½¥ï¾Ÿ Â· âœ¦ Â· ï½¥ï¾Ÿ Â· âœ§</div>
            </div>
          </main>
        `;
        
        EventManager.attach('start-btn', 'click', ActionHandler.drawCard);
        EventManager.attach('rules-btn', 'click', ActionHandler.goToRules);
        EventManager.attach('guide-btn', 'click', ActionHandler.goToGuide);
        
      } else if (AppState.currentPage === "shuffling") {
        app.innerHTML = starfield + `
          <main class="main-container" style="min-height: 100%; display: flex; align-items: center; justify-content: center; overflow: hidden; position: relative;">
            <div style="position: relative; width: 100%; height: 100%;">
              ${Array.from({length: 22}, (_, i) => {
                const angle = (Math.PI * 2 * i) / 22;
                const radius = Math.min(window.innerWidth, window.innerHeight) * 0.65;
                const endX = Math.cos(angle) * radius;
                const endY = Math.sin(angle) * radius;
                const rotation = Math.random() * 720 + 360;
                return `
                  <div style="position: absolute; top: 50%; left: 50%; width: ${baseSize * 4}px; height: ${baseSize * 6}px; transform: translate(-50%, -50%); animation: explosionCard${i} 2s ease-out forwards;">
                    <div style="width: 100%; height: 100%; background: linear-gradient(135deg, #1a1a3e, #0f172a); border: 3px solid #ffd700; border-radius: ${baseSize * 0.6}px; display: flex; align-items: center; justify-content: center; font-size: ${baseSize * 2.5}px; box-shadow: 0 0 40px rgba(255, 215, 0, 0.7);">
                      <img src="https://static.wixstatic.com/media/bd0ac1_90e5fd2318f6426798f1683b3a48a473~mv2.png" alt="å¡”ç¾…ç‰Œ" style="width: 100%; height: 100%; object-fit: cover; border-radius: ${baseSize * 0.4}px;" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                      <div style="display: none;">ğŸ´</div>
                    </div>
                  </div>
                  <style>
                    @keyframes explosionCard${i} {
                      0% {
                        transform: translate(-50%, -50%) scale(0.1) rotate(0deg);
                        opacity: 0;
                      }
                      40% {
                        transform: translate(calc(-50% + ${endX}px), calc(-50% + ${endY}px)) scale(1) rotate(${rotation}deg);
                        opacity: 1;
                      }
                      100% {
                        transform: translate(calc(-50% + ${endX * 1.5}px), calc(-50% + ${endY * 1.5}px)) scale(0.8) rotate(${rotation + 180}deg);
                        opacity: 0;
                      }
                    }
                  </style>
                `;
              }).join('')}
              <div style="position: absolute; top: 18%; left: 50%; transform: translateX(-50%); text-align: center; z-index: 100; width: 90%; max-width: 900px;">
                <h2 class="animation-title" style="font-size: ${baseSize * 1.6}px; font-weight: bold; background: linear-gradient(135deg, #ffd700 0%, #fbbf24 25%, #e0e7ff 50%, #fbbf24 75%, #ffd700 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-size: 200% auto; animation: shimmer 4s ease-in-out infinite; margin-bottom: ${baseSize * 0.7}px; letter-spacing: 3px; white-space: nowrap;">âœ¨ æ´—ç‰Œä¸­ âœ¨</h2>
                <p style="font-size: ${baseSize * 1.2}px; opacity: 0.95; text-shadow: 0 0 15px rgba(224, 231, 255, 0.7); white-space: nowrap; font-weight: 500;">å¨ç§€å¡”ç¾…ç‰Œéˆé­‚æŒ‡å¼•</p>
              </div>
            </div>
          </main>
        `;
      } else if (AppState.currentPage === "cutting") {
        app.innerHTML = starfield + `
          <main class="main-container" style="min-height: 100%; display: flex; flex-direction: column; align-items: center; justify-content: center; overflow: hidden; position: relative; padding-top: ${baseSize * 7}px;">
            <div style="position: absolute; top: ${baseSize * 4}px; left: 50%; transform: translateX(-50%); text-align: center; z-index: 100; width: 90%; max-width: 900px;">
              <h2 class="animation-title" style="font-size: ${baseSize * 1.6}px; font-weight: bold; background: linear-gradient(135deg, #ffd700 0%, #fbbf24 25%, #e0e7ff 50%, #fbbf24 75%, #ffd700 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-size: 200% auto; animation: shimmer 4s ease-in-out infinite; margin-bottom: ${baseSize * 0.7}px; letter-spacing: 3px; white-space: nowrap;">âœ¨ åˆ‡ç‰Œä¸­ âœ¨</h2>
              <p style="font-size: ${baseSize * 1.2}px; opacity: 0.95; text-shadow: 0 0 15px rgba(224, 231, 255, 0.7); white-space: nowrap; font-weight: 500;">é‡æ’ä½ çš„å‘½é‹è»Œè·¡</p>
            </div>
            <div class="card-spread" style="position: relative; width: 100%; height: 100%; display: flex; align-items: center; justify-content: center;">
              <div style="position: relative; width: ${baseSize * 14}px; height: ${baseSize * 9}px;">
                ${Array.from({length: 22}, (_, i) => `
                  <div style="position: absolute; top: 50%; left: 50%; width: ${baseSize * 4}px; height: ${baseSize * 6}px; transform: translate(-50%, -50%) translateX(${-baseSize * 2 + i * (baseSize * 0.18)}px) translateY(${i * (baseSize * 0.09)}px) rotate(${i * 0.5}deg); transition: all 0.8s cubic-bezier(0.68, -0.55, 0.265, 1.55); animation: cutCard${i} 2.5s ease-in-out forwards;">
                    <div style="width: 100%; height: 100%; background: linear-gradient(135deg, #1a1a3e, #0f172a); border: 3px solid #ffd700; border-radius: ${baseSize * 0.6}px; display: flex; align-items: center; justify-content: center; font-size: ${baseSize * 2.5}px; box-shadow: 0 0 40px rgba(255, 215, 0, 0.7);">
                      <img src="https://static.wixstatic.com/media/bd0ac1_90e5fd2318f6426798f1683b3a48a473~mv2.png" alt="å¡”ç¾…ç‰Œ" style="width: 100%; height: 100%; object-fit: cover; border-radius: ${baseSize * 0.4}px;" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                      <div style="display: none;">ğŸ´</div>
                    </div>
                  </div>
                  <style>
                    @keyframes cutCard${i} {
                      0% {
                        transform: translate(-50%, -50%) translateX(${-baseSize * 2 + i * (baseSize * 0.18)}px) translateY(${i * (baseSize * 0.09)}px) rotate(${i * 0.5}deg);
                      }
                      50% {
                        transform: translate(-50%, -50%) translateX(${i < 11 ? -baseSize * 5 : baseSize * 5}px) translateY(${i * (baseSize * 0.12)}px) rotate(${i < 11 ? -6 : 6}deg);
                      }
                      100% {
                        transform: translate(-50%, -50%) translateX(${-baseSize * 2 + (21 - i) * (baseSize * 0.18)}px) translateY(${(21 - i) * (baseSize * 0.09)}px) rotate(${(21 - i) * 0.5}deg);
                      }
                    }
                  </style>
                `).join('')}
              </div>
            </div>
          </main>
        `;
      } else if (AppState.currentPage === "spreading") {
        app.innerHTML = starfield + `
          <main class="main-container" style="min-height: 100%; display: flex; align-items: center; justify-content: center; overflow: hidden; position: relative;">
            <div style="position: relative; width: 100%; height: 100%;">
              ${AppState.shuffledCards.map((card, i) => {
                const angle = (Math.PI * 2 * i) / 22;
                const radius = Math.min(window.innerWidth, window.innerHeight) * 0.85;
                const endX = Math.cos(angle) * radius;
                const endY = Math.sin(angle) * radius;
                const rotation = Math.random() * 1080 + 720;
                const delay = Math.random() * 0.8;
                return `
                  <div style="position: absolute; top: 50%; left: 50%; width: ${baseSize * 4}px; height: ${baseSize * 6}px; transform: translate(-50%, -50%); animation: fairySpread${i} 3s ease-out ${delay}s forwards;">
                    <div style="width: 100%; height: 100%; background: linear-gradient(135deg, #1a1a3e, #0f172a); border: 3px solid #ffd700; border-radius: ${baseSize * 0.6}px; display: flex; align-items: center; justify-content: center; font-size: ${baseSize * 2.5}px; box-shadow: 0 0 45px rgba(255, 215, 0, 0.85);">
                      <img src="https://static.wixstatic.com/media/bd0ac1_90e5fd2318f6426798f1683b3a48a473~mv2.png" alt="å¡”ç¾…ç‰Œ" style="width: 100%; height: 100%; object-fit: cover; border-radius: ${baseSize * 0.4}px; pointer-events: none;" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                      <div style="display: none; font-size: ${baseSize * 3}px;">ğŸ´</div>
                    </div>
                  </div>
                  <style>
                    @keyframes fairySpread${i} {
                      0% {
                        transform: translate(-50%, -50%) scale(1) rotate(0deg);
                        opacity: 1;
                      }
                      50% {
                        transform: translate(calc(-50% + ${endX * 0.6}px), calc(-50% + ${endY * 0.6}px)) scale(1.2) rotate(${rotation * 0.5}deg);
                        opacity: 1;
                      }
                      100% {
                        transform: translate(calc(-50% + ${endX * 1.5}px), calc(-50% + ${endY * 1.5}px)) scale(0.3) rotate(${rotation}deg);
                        opacity: 0;
                      }
                    }
                  </style>
                `;
              }).join('')}
            </div>
          </main>
        `;
      } else if (AppState.currentPage === "result" && AppState.selectedCard) {
        renderResultPage(AppState.selectedCard, baseSize);
      } else if (AppState.currentPage === "guide") {
        app.innerHTML = starfield + `
          <main class="main-container" style="min-height: 100%; padding: ${baseSize * 1.5}px;">
            <div style="max-width: 1000px; margin: 0 auto;">
              <h2 style="font-size: ${baseSize * 2}px; font-weight: bold; color: #ffd700; margin-bottom: ${baseSize * 0.7}px; text-align: center; letter-spacing: 2px;">å¨ç§€å½±åŸ22å¼µå¡”ç¾…ç‰Œç¾©</h2>
              <p style="font-size: ${baseSize * 1.1}px; text-align: center; opacity: 0.9; margin-bottom: ${baseSize * 1.8}px; letter-spacing: 1.5px; font-weight: 500;">æ¢ç´¢ä½ ç”Ÿå‘½æ—…ç¨‹çš„22å¼µéˆé­‚æŒ‡å¼•</p>
              <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); gap: ${baseSize * 1.5}px; margin-bottom: ${baseSize * 1.5}px;">
                ${tarotCards.map(card => `
                  <div class="golden-frame" style="background: linear-gradient(135deg, rgba(26, 26, 62, 0.9), rgba(15, 23, 42, 0.9)); border-radius: ${baseSize * 0.8}px; padding: ${baseSize * 1.3}px;">
                    <img src="${card.image}" alt="${card.name}" style="width: 100%; height: ${baseSize * 7.5}px; object-fit: contain; border-radius: ${baseSize * 0.6}px; margin-bottom: ${baseSize * 0.8}px;" onerror="this.style.display='none';">
                    <h3 style="font-size: ${baseSize * 1.15}px; font-weight: bold; color: #ffd700; margin-bottom: ${baseSize * 0.6}px; letter-spacing: 1px;">${card.number}. ${card.name}</h3>
                    <p style="font-size: ${baseSize * 0.85}px; opacity: 0.9; margin-bottom: ${baseSize * 0.7}px; line-height: 1.6;"><span style="color: #4ade80; font-weight: bold;">æ­£ä½</span> ${card.upright}</p>
                    <p style="font-size: ${baseSize * 0.85}px; opacity: 0.9; line-height: 1.6;"><span style="color: #f87171; font-weight: bold;">é€†ä½</span> ${card.reversed}</p>
                  </div>
                `).join('')}
              </div>
              <button id="home-btn-guide" class="golden-frame" style="background: ${config.primary_action_color}; padding: ${baseSize * 1.1}px ${baseSize * 3}px; border-radius: ${baseSize * 0.8}px; font-size: ${baseSize * 1.2}px; font-weight: bold; cursor: pointer; display: block; margin: 0 auto; box-shadow: 0 8px 30px rgba(67, 56, 202, 0.5); touch-action: manipulation; user-select: none; border: none;">è¿”å›é¦–é </button>
            </div>
          </main>
        `;
        EventManager.attach('home-btn-guide', 'click', ActionHandler.goToHome);
      } else if (AppState.currentPage === "rules") {
        app.innerHTML = starfield + `
          <main class="main-container" style="min-height: 100%; display: flex; align-items: center; justify-content: center; padding: ${baseSize * 1.5}px;">
            <div class="slide-in" style="max-width: 700px; width: 100%;">
              <div class="golden-frame" style="background: linear-gradient(135deg, rgba(26, 26, 62, 0.9), rgba(15, 23, 42, 0.9)); border-radius: ${baseSize * 1.3}px; padding: ${baseSize * 2.2}px;">
                <h2 style="font-size: ${baseSize * 1.8}px; font-weight: bold; color: #ffd700; margin-bottom: ${baseSize * 1.5}px; text-align: center; letter-spacing: 2px;">æŠ½ç‰Œè¦å‰‡</h2>
                <div style="background: rgba(99, 102, 241, 0.25); border: 2px solid rgba(99, 102, 241, 0.4); border-radius: ${baseSize * 0.8}px; padding: ${baseSize * 1.3}px; margin-bottom: ${baseSize * 1.3}px;">
                  <h3 style="font-size: ${baseSize * 1.15}px; font-weight: bold; margin-bottom: ${baseSize * 0.7}px; color: #fbbf24;">1ï¸âƒ£ éœå¿ƒæº–å‚™</h3>
                  <p style="font-size: ${baseSize * 0.95}px; line-height: 1.8; font-weight: 500;">æ·±å‘¼å¸ä¸‰æ¬¡ï¼Œæ”¾ç©ºå¿ƒæ€ã€‚æƒ³æƒ³ä½ ç¾åœ¨çš„å¿ƒæƒ…ç‹€æ…‹ï¼Œä¸éœ€è¦æœ‰å•é¡Œã€‚</p>
                </div>
                <div style="background: rgba(99, 102, 241, 0.25); border: 2px solid rgba(99, 102, 241, 0.4); border-radius: ${baseSize * 0.8}px; padding: ${baseSize * 1.3}px; margin-bottom: ${baseSize * 1.3}px;">
                  <h3 style="font-size: ${baseSize * 1.15}px; font-weight: bold; margin-bottom: ${baseSize * 0.7}px; color: #fbbf24;">2ï¸âƒ£ æ†‘ç›´è¦ºé¸ç‰Œ</h3>
                  <p style="font-size: ${baseSize * 0.95}px; line-height: 1.8; font-weight: 500;">é»æ“Šã€Œå•Ÿå‹•ç¥ç§˜å¡”ç¾…ã€ï¼Œå¾å±•é–‹çš„ç‰Œä¸­é¸ä¸€å¼µæœ€æœ‰æ„Ÿè¦ºçš„ã€‚</p>
                </div>
                <div style="background: rgba(99, 102, 241, 0.25); border: 2px solid rgba(99, 102, 241, 0.4); border-radius: ${baseSize * 0.8}px; padding: ${baseSize * 1.3}px; margin-bottom: ${baseSize * 1.8}px;">
                  <h3 style="font-size: ${baseSize * 1.15}px; font-weight: bold; margin-bottom: ${baseSize * 0.7}px; color: #fbbf24;">3ï¸âƒ£ è§£è®€è¨Šæ¯</h3>
                  <p style="font-size: ${baseSize * 0.95}px; line-height: 1.8; font-weight: 500;">ç‰Œå¡æœƒå‘Šè¨´ä½ ç¾åœ¨çš„ç‹€æ…‹ã€‚æ­£ä½è·Ÿé€†ä½ä»£è¡¨ä¸åŒçš„è§£è®€è§’åº¦ã€‚</p>
                </div>
                <button id="home-btn-rules" class="golden-frame" style="background: ${config.primary_action_color}; padding: ${baseSize * 1.1}px ${baseSize * 3}px; border-radius: ${baseSize * 0.8}px; font-size: ${baseSize * 1.2}px; font-weight: bold; cursor: pointer; width: 100%; box-shadow: 0 8px 30px rgba(67, 56, 202, 0.5); touch-action: manipulation; user-select: none; border: none;">è¿”å›é¦–é </button>
              </div>
            </div>
          </main>
        `;
        EventManager.attach('home-btn-rules', 'click', ActionHandler.goToHome);
      }
    }

    // ============================================
    // SDK é…ç½®èˆ‡åˆå§‹åŒ–
    // ============================================
    async function onConfigChange(config) {
      const app = document.getElementById("app");
      app.style.backgroundColor = config.background_color || defaultConfig.background_color;
      app.style.color = config.text_color || defaultConfig.text_color;
      document.body.style.backgroundColor = config.background_color || defaultConfig.background_color;
      render();
    }

    if (window.elementSdk) {
      window.elementSdk.init({
        defaultConfig,
        onConfigChange,
        mapToCapabilities: (config) => ({
          recolorables: [
            { get: () => config.background_color || defaultConfig.background_color, set: (value) => { config.background_color = value; window.elementSdk.setConfig({ background_color: value }); } },
            { get: () => config.surface_color || defaultConfig.surface_color, set: (value) => { config.surface_color = value; window.elementSdk.setConfig({ surface_color: value }); } },
            { get: () => config.text_color || defaultConfig.text_color, set: (value) => { config.text_color = value; window.elementSdk.setConfig({ text_color: value }); } },
            { get: () => config.primary_action_color || defaultConfig.primary_action_color, set: (value) => { config.primary_action_color = value; window.elementSdk.setConfig({ primary_action_color: value }); } },
            { get: () => config.secondary_action_color || defaultConfig.secondary_action_color, set: (value) => { config.secondary_action_color = value; window.elementSdk.setConfig({ secondary_action_color: value }); } }
          ],
          borderables: [],
          fontEditable: {
            get: () => config.font_family || defaultConfig.font_family,
            set: (value) => { config.font_family = value; window.elementSdk.setConfig({ font_family: value }); }
          },
          fontSizeable: {
            get: () => config.font_size || defaultConfig.font_size,
            set: (value) => { config.font_size = value; window.elementSdk.setConfig({ font_size: value }); }
          }
        }),
        mapToEditPanelValues: (config) => new Map([
          ["app_title", config.app_title || defaultConfig.app_title],
          ["app_subtitle", config.app_subtitle || defaultConfig.app_subtitle],
          ["start_button_text", config.start_button_text || defaultConfig.start_button_text],
          ["restart_button_text", config.restart_button_text || defaultConfig.restart_button_text],
          ["guide_button_text", config.guide_button_text || defaultConfig.guide_button_text]
        ])
      });
    }

    // ============================================
    // å•Ÿå‹•æ‡‰ç”¨
    // ============================================
    render();
  </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9b85bd364688a9c2',t:'MTc2NzQ3NzMxMy4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>